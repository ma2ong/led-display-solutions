<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin System Enhancements Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container-fluid py-4">
        <h1 class="mb-4">Admin System Enhancements Test</h1>
        
        <!-- Enhanced Dashboard Stats Test -->
        <div class="row mb-4">
            <div class="col-12">
                <h3>Enhanced Dashboard Statistics</h3>
                <div class="card">
                    <div class="card-body">
                        <button class="btn btn-primary" onclick="testDashboardStats()">Test Dashboard Stats API</button>
                        <div id="dashboard-stats-result" class="mt-3"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Bulk Operations Test -->
        <div class="row mb-4">
            <div class="col-12">
                <h3>Bulk Operations Test</h3>
                <div class="card">
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="productIds" class="form-label">Product IDs (comma-separated):</label>
                            <input type="text" class="form-control" id="productIds" placeholder="1,2,3">
                        </div>
                        <div class="mb-3">
                            <label for="bulkAction" class="form-label">Action:</label>
                            <select class="form-select" id="bulkAction">
                                <option value="activate">Activate</option>
                                <option value="deactivate">Deactivate</option>
                                <option value="feature">Feature</option>
                                <option value="unfeature">Unfeature</option>
                                <option value="delete">Delete</option>
                            </select>
                        </div>
                        <button class="btn btn-warning" onclick="testBulkOperation()">Test Bulk Operation</button>
                        <div id="bulk-operation-result" class="mt-3"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- File Upload Test -->
        <div class="row mb-4">
            <div class="col-12">
                <h3>Enhanced File Upload Test</h3>
                <div class="card">
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="fileUpload" class="form-label">Select Image File:</label>
                            <input type="file" class="form-control" id="fileUpload" accept="image/*">
                        </div>
                        <button class="btn btn-success" onclick="testFileUpload()">Test File Upload</button>
                        <div id="file-upload-result" class="mt-3"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Inquiry Management Test -->
        <div class="row mb-4">
            <div class="col-12">
                <h3>Enhanced Inquiry Management Test</h3>
                <div class="card">
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h5>Inquiry Statistics</h5>
                                <button class="btn btn-info" onclick="testInquiryStats()">Test Inquiry Stats</button>
                                <div id="inquiry-stats-result" class="mt-3"></div>
                            </div>
                            <div class="col-md-6">
                                <h5>Bulk Inquiry Update</h5>
                                <div class="mb-3">
                                    <label for="inquiryIds" class="form-label">Inquiry IDs:</label>
                                    <input type="text" class="form-control" id="inquiryIds" placeholder="1,2,3">
                                </div>
                                <div class="mb-3">
                                    <label for="inquiryAction" class="form-label">Action:</label>
                                    <select class="form-select" id="inquiryAction">
                                        <option value="update_status">Update Status</option>
                                        <option value="update_priority">Update Priority</option>
                                        <option value="assign">Assign</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="inquiryValue" class="form-label">Value:</label>
                                    <input type="text" class="form-control" id="inquiryValue" placeholder="new, high, user_id">
                                </div>
                                <button class="btn btn-warning" onclick="testInquiryBulkUpdate()">Test Bulk Update</button>
                                <div id="inquiry-bulk-result" class="mt-3"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- System Health Check -->
        <div class="row mb-4">
            <div class="col-12">
                <h3>System Health Check</h3>
                <div class="card">
                    <div class="card-body">
                        <button class="btn btn-secondary" onclick="testSystemHealth()">Check System Health</button>
                        <div id="system-health-result" class="mt-3"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Test Dashboard Stats API
        async function testDashboardStats() {
            try {
                const response = await fetch('/api/admin/dashboard/stats');
                const data = await response.json();
                
                document.getElementById('dashboard-stats-result').innerHTML = `
                    <div class="alert alert-success">
                        <h6>Dashboard Stats Response:</h6>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                document.getElementById('dashboard-stats-result').innerHTML = `
                    <div class="alert alert-danger">
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            }
        }
        
        // Test Bulk Operation
        async function testBulkOperation() {
            const productIds = document.getElementById('productIds').value.split(',').map(id => parseInt(id.trim())).filter(id => !isNaN(id));
            const action = document.getElementById('bulkAction').value;
            
            if (productIds.length === 0) {
                document.getElementById('bulk-operation-result').innerHTML = `
                    <div class="alert alert-warning">Please enter valid product IDs</div>
                `;
                return;
            }
            
            try {
                const response = await fetch('/api/admin/products/bulk', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        product_ids: productIds,
                        action: action
                    })
                });
                
                const data = await response.json();
                
                document.getElementById('bulk-operation-result').innerHTML = `
                    <div class="alert alert-${data.success ? 'success' : 'danger'}">
                        <h6>Bulk Operation Response:</h6>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                document.getElementById('bulk-operation-result').innerHTML = `
                    <div class="alert alert-danger">
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            }
        }
        
        // Test File Upload
        async function testFileUpload() {
            const fileInput = document.getElementById('fileUpload');
            const file = fileInput.files[0];
            
            if (!file) {
                document.getElementById('file-upload-result').innerHTML = `
                    <div class="alert alert-warning">Please select a file</div>
                `;
                return;
            }
            
            const formData = new FormData();
            formData.append('file', file);
            
            try {
                const response = await fetch('/api/admin/upload', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                document.getElementById('file-upload-result').innerHTML = `
                    <div class="alert alert-${data.success ? 'success' : 'danger'}">
                        <h6>File Upload Response:</h6>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                        ${data.success && data.url ? `<img src="${data.url}" class="img-thumbnail mt-2" style="max-width: 200px;">` : ''}
                    </div>
                `;
            } catch (error) {
                document.getElementById('file-upload-result').innerHTML = `
                    <div class="alert alert-danger">
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            }
        }
        
        // Test Inquiry Stats
        async function testInquiryStats() {
            try {
                const response = await fetch('/api/admin/inquiries/stats');
                const data = await response.json();
                
                document.getElementById('inquiry-stats-result').innerHTML = `
                    <div class="alert alert-${data.success !== false ? 'success' : 'danger'}">
                        <h6>Inquiry Stats Response:</h6>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                document.getElementById('inquiry-stats-result').innerHTML = `
                    <div class="alert alert-danger">
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            }
        }
        
        // Test Inquiry Bulk Update
        async function testInquiryBulkUpdate() {
            const inquiryIds = document.getElementById('inquiryIds').value.split(',').map(id => parseInt(id.trim())).filter(id => !isNaN(id));
            const action = document.getElementById('inquiryAction').value;
            const value = document.getElementById('inquiryValue').value;
            
            if (inquiryIds.length === 0) {
                document.getElementById('inquiry-bulk-result').innerHTML = `
                    <div class="alert alert-warning">Please enter valid inquiry IDs</div>
                `;
                return;
            }
            
            const requestData = {
                inquiry_ids: inquiryIds,
                action: action
            };
            
            // Add the appropriate field based on action
            if (action === 'update_status') {
                requestData.status = value;
            } else if (action === 'update_priority') {
                requestData.priority = value;
            } else if (action === 'assign') {
                requestData.assigned_to = parseInt(value) || null;
            }
            
            try {
                const response = await fetch('/api/admin/inquiries/bulk-update', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });
                
                const data = await response.json();
                
                document.getElementById('inquiry-bulk-result').innerHTML = `
                    <div class="alert alert-${data.success ? 'success' : 'danger'}">
                        <h6>Inquiry Bulk Update Response:</h6>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                document.getElementById('inquiry-bulk-result').innerHTML = `
                    <div class="alert alert-danger">
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            }
        }
        
        // Test System Health
        async function testSystemHealth() {
            try {
                const response = await fetch('/api/admin/health');
                const data = await response.json();
                
                document.getElementById('system-health-result').innerHTML = `
                    <div class="alert alert-${data.status === 'healthy' ? 'success' : 'warning'}">
                        <h6>System Health Response:</h6>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                document.getElementById('system-health-result').innerHTML = `
                    <div class="alert alert-danger">
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
            }
        }
    </script>
</body>
</html>